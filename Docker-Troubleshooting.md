# Docker 使用问题排查

## Docker 镜像拉取问题排查小结

## ? 日期
2025年9月21日

## 问题描述
在 Docker 拉取镜像时，持续遇到以下网络连接错误：
- `unexpected status from HEAD request to docker.io:403 Forbidden`
- `EOF` 错误

## 尝试的解决方案
1. **更换镜像源**：依次尝试阿里云镜像源、清华镜像源、Docker Hub 官方源。
2. **开启全局 VPN**：在系统层面开启全局代理模式。
3. **混合测试**：不同镜像源与 VPN 开关的组合测试。

**结果**：以上方案均未解决问题，错误依旧。

## 根本原因分析
Docker 守护进程运行在独立的网络命名空间中，不自动继承宿主机的系统代理设置。即使系统开启了全局 VPN，Docker 容器内的网络请求仍会直连外网，导致无法访问镜像仓库。

## 最终解决方案

### 方案A：开启虚拟网卡（TUN）模式
- 在代理客户端（如 Clash Verge）中启用 **TUN 模式**/虚拟网卡模式。
- 此模式在系统底层创建虚拟网卡，强制所有网络流量（包括 Docker）经过代理。
- **效果**：一劳永逸，无需额外配置。

### 方案B：为 Docker 设置全局代理
在启动 Docker 前设置以下环境变量：
```bash
set HTTP_PROXY=http://127.0.0.1:7890
set HTTPS_PROXY=http://127.0.0.1:7890
```

## 经验总结
1. **Docker 网络隔离性**：Docker 的网络命名空间隔离特性导致其不继承系统代理。
2. **TUN 模式优势**：虚拟网卡模式是解决容器网络代理的最彻底方案。
3. **镜像源选择**：国内源并非万能解决方案，对境外镜像仓库的访问仍需代理。
4. **403 Forbidden 含义**：通常是网络可达但被拒绝访问，与网络连通性问题不同。

## ? 预防措施
- 长期使用建议开启 TUN 模式。
- 在需要拉取境外镜像时，确保代理配置正确。

---

*记录于问题解决后，以备后续查阅*